<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shared Mini Browser</title>
<style>
body { font-family: sans-serif; margin: 10px; }
input { width: 50%; padding: 5px; }
button { padding: 5px 10px; margin-left: 5px; margin-top: 5px; }
iframe { width: 100%; height: 500px; margin-top: 10px; border: 1px solid #ccc; }
#status { margin-top: 5px; color: #555; }
#preload { margin-top: 10px; }
#preload button { margin-right: 5px; }
</style>
</head>
<body>

<h2>Shared Mini Browser</h2>

<input id="url" placeholder="Enter a URL" />
<button id="go">Go</button>
<div id="status">Tip: Google / DuckDuckGo wonâ€™t load in the iframe. They will open in a new tab.</div>

<div id="preload">
  <strong>Safe Sites:</strong>
  <button data-url="https://example.com">Example</button>
  <button data-url="https://wikipedia.org">Wikipedia</button>
  <button data-url="https://mozilla.org">Mozilla</button>
</div>

<iframe id="frame"></iframe>

<script>
const frame = document.getElementById('frame');
const urlInput = document.getElementById('url');
const status = document.getElementById('status');
const goButton = document.getElementById('go');
const preloadButtons = document.querySelectorAll('#preload button');

// SSE connection to sync URLs
const evtSource = new EventSource('shared-browse.contactlandinreese.workers.dev/events');
evtSource.onmessage = e => {
  if (e.data === 'ping') return;
  loadURL(e.data, false); // false = do not resend to server
};

// Handle manual URL entry
goButton.onclick = () => {
  const url = urlInput.value.trim();
  if (!url) return;
  loadURL(url, true);
};

// Handle preloaded button clicks
preloadButtons.forEach(btn => {
  btn.onclick = () => {
    const url = btn.getAttribute('data-url');
    loadURL(url, true);
  };
});

// Core URL loading function
function loadURL(url, sendToServer) {
  if (!url.startsWith('http')) url = 'https://' + url;
  try {
    frame.src = url;
    frame.onload = () => {
      try {
        const doc = frame.contentDocument || frame.contentWindow.document;
        doc.body; // check access
        status.textContent = 'Loaded in iframe!';
      } catch (e) {
        frame.src = '';
        window.open(url, '_blank');
        status.textContent = 'Page blocked in iframe, opened in new tab.';
      }
    };
    if (sendToServer) {
      fetch('shared-browse.contactlandinreese.workers.dev/set', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });
    }
  } catch(e) {
    window.open(url, '_blank');
    status.textContent = 'Page blocked, opened in new tab.';
  }
}
</script>

</body>
</html>

